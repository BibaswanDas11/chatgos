<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bibo's Creation Chatgos</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header class="main-header">
  Bibo's Creation Chatgos
</header>

<div class="auth-container">

  <h2>Create Account</h2>

  <input type="text" id="username" placeholder="Username">
  <input type="text" id="userid" placeholder="Unique ID (letters & numbers)">
  <span id="idError" class="error"></span>
  <input type="password" id="password" placeholder="Password">

  <button id="signupBtn" class="royal-btn" type="button">
    Create Account
  </button>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const supabaseUrl = "https://yxbofwrmutyewqhhxidp.supabase.co";
const supabaseKey = "sb_publishable_KMKcxhxp5NXQswNPrM1ruA_KwG0j2bD";

const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

const username = document.getElementById("username");
const userid = document.getElementById("userid");
const password = document.getElementById("password");
const signupBtn = document.getElementById("signupBtn");
const idError = document.getElementById("idError");

userid.addEventListener("input", async () => {
  if (!userid.value) return;

  const { data } = await supabaseClient
    .from("users")
    .select("id")
    .eq("user_id", userid.value);

  if (data && data.length > 0) {
    idError.textContent = "User ID already exists";
  } else {
    idError.textContent = "";
  }
});

signupBtn.onclick = async () => {
  if (idError.textContent !== "") return;

  const { error } = await supabaseClient.from("users").insert({
    username: username.value,
    user_id: userid.value,
    password: password.value,
    dp_url: "",
    status: "online"
  });

  if (error) {
    alert(error.message);
    return;
  }

  localStorage.setItem("user_id", userid.value);
  window.location.href = "chat.html";
};
</script>

</body>
</html>
